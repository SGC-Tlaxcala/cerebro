{% extends 'base.html' %}
{% load staticfiles %}

{% block header %}
  <link rel="stylesheet" href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
{% endblock header%}

{% block footer %}
  <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']})
    google.charts.setOnLoadCallback(pieTotal)
    google.charts.setOnLoadCallback(pieDistrito01)
    google.charts.setOnLoadCallback(pieDistrito02)
    google.charts.setOnLoadCallback(pieDistrito03)
    google.charts.setOnLoadCallback(atencionDistritos)

    $.extend($.fn.dataTable.defaults, {
      searching: false,
      pageLength: 20
    })

    $(document).ready(() => $('#tabla_distrito_01').DataTable({"language": {"url":"https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"}}))
    $(document).ready(() => $('#tabla_distrito_02').DataTable({"language": {"url":"https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"}}))
    $(document).ready(() => $('#tabla_distrito_03').DataTable({"language": {"url":"https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"}}))

    function pieTotal() {
      const data = google.visualization.arrayToDataTable([
        ['Expediente', 'Cuenta'],
        ['Completo', {{ estatal.completos }}],
        ['Incompleto', {{ estatal.incompletos }}]
      ])
      const options = {
        legend: 'none',
        'width': 400,
        'height': 400,
        'chartArea': {'width': '100%', 'height': '90%'},
      }
      const chart = new google.visualization.PieChart(document.getElementById('total_chart'))
      chart.draw(data, options)
    }

    function pieDistrito01() {
      const data = google.visualization.arrayToDataTable([
        ['Expediente', 'Cuenta'],
        ['Completo', {{ distrito.1.completos }}],
        ['Incompleto', {{ distrito.1.incompletos }}]
      ])
      const options = {
        legend: 'none',
        'width': 400,
        'height': 400,
        'chartArea': {'width': '100%', 'height': '90%'},
      }
      const chart = new google.visualization.PieChart(document.getElementById('distrito_1'))
      chart.draw(data, options)
    }

    function pieDistrito02() {
      const data = google.visualization.arrayToDataTable([
        ['Expediente', 'Cuenta'],
        ['Completo', {{ distrito.2.completos }}],
        ['Incompleto', {{ distrito.2.incompletos }}]
      ])
      const options = {
        legend: 'none',
        'width': 400,
        'height': 400,
        'chartArea': {'width': '100%', 'height': '90%'},
      }
      const chart = new google.visualization.PieChart(document.getElementById('distrito_2'))
      chart.draw(data, options)
    }

    function pieDistrito03() {
      const data = google.visualization.arrayToDataTable([
        ['Expediente', 'Cuenta'],
        ['Completo', {{ distrito.3.completos }}],
        ['Incompleto', {{ distrito.3.incompletos }}]
      ])
      const options = {
        legend: 'none',
        'width': 400,
        'height': 400,
        'chartArea': {'width': '100%', 'height': '90%'},
      }
      const chart = new google.visualization.PieChart(document.getElementById('distrito_3'))
      chart.draw(data, options)
    }

    function atencionDistritos() {
      const data = google.visualization.arrayToDataTable([
        ['Distrito', 'Promedio', 'Límite'],{% for row in estatal.delta %}
          ['Distrito 0{{ row.distrito }}', {{ row.atencion|floatformat:2 }}, 9]{% if not forloop.last %},{% endif %}{% endfor %}
        ])

      const options = {
        title: 'Promedio de días de atención por expediente',
        legend: 'none',
        vAxis: {title: 'Días'},
        hAxis: {},
        height: 600,
        chartArea: {'width': '100%', 'height': '90%'},
        seriesType: 'bars',
        series: {1: {type: 'line'}}
      }

      const chart = new google.visualization.ComboChart(document.getElementById('atencion_chart'))
      chart.draw(data, options)
    }

  </script>
{% endblock footer %}

{% block content %}
  <div class="row">
    <div class="col">
      <h1 class="display-3"><i class="fa fa-user-secret"></i> Control de DPI <small class="text-muted">{{ year }}</small></h1>
      <hr>
      <p>
        <a class="btn btn-danger"  href="{% url 'dpi:dpi_add' %}"><i class="fa fa-plus"></i> Agregar expediente</a>
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <h3>Estadísticas totales</h3>
      <ul>
        <li><strong>Total de registros:</strong> {{ estatal.total }}</li>
        <li><strong>Expedientes completos:</strong> {{ estatal.completos }}</li>
        <li><strong>Expedientes incompletos:</strong> {{ estatal.incompletos }}</li>
        <li><strong>Avance:</strong> {{ estatal.porcentaje|floatformat:2 }}%</li>
      </ul>
    </div>
    <div class="col">
      <div id="total_chart" style="min-width: 400px; height: 400px;"></div>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <table class="table">
        <thead>
          <th>Tipo</th>
          <th>Folio</th>
          <th>Fecha de Trámite</th>
        </thead>
        <tbody>{% for r in italia %}
          <tr>
            <td>{{ r.tipo }}</td>
            <td><a href="{% url 'dpi:edit' r.folio %}">{{ r.folio }}</a></td>
            <td>{{ r.fecha_tramite }}</td>
          </tr>{% endfor %}
        </tbody>
      </table>
    </div>
  </div>

{% endblock content %}


