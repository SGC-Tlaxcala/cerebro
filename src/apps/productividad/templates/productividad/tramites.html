{% extends 'base.html' %}
{% load humanize %} 
{% load sgc %}

{% block footer %}
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', {packages: ['corechart', 'bar']})
    google.charts.setOnLoadCallback(tramitesChart)
    google.charts.setOnLoadCallback(estatalChart)

    function estatalChart() {
      const data = google.visualization.arrayToDataTable([
        ['Tramites', 'Cantidad'],
        ['Realizados', {{ estatal.tramites }}],
        ['Faltantes', {{ estatal.faltantes }}]
      ])

      const options = {
        title: 'Seguimiento al pronóstico estatal'
      }

      let chart = new google.visualization.PieChart(document.getElementById('estatal_chart'))
      chart.draw(data, options)
    }

    function tramitesChart() {
      const data = google.visualization.arrayToDataTable([
        ['Distrito', 'Realizados', 'Faltantes', { role: 'annotation' } ],
        {% for c in chart_data %}
        ['{{c.0}}', {{c.1}}, {{c.3}}, '']{% if not forloop.last %},{% endif %}{% endfor %}
      ])

      const options = {
        title: "Seguimiento de trámites por distrito",
        height: 400,
        legend: {position: 'top', maxLines: 3},
        isStacked: true
      }

      const chart = new google.visualization.BarChart(document.getElementById('tramites_chart'))
      chart.draw(data, options)
    }
  </script>
{% endblock footer %}

{% block content %}
<div class="row">
  <div class="col">
    <div class="jumbotron">
      <h1 class="display-4"><i class="fa fa-bar-chart"></i> {{ title }}</h1>
      <p class="lead">
        Contribuye al seguimiento del pronóstico de trámites.
      </p>
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <div id="tramites_chart"></div>
  </div>
</div>

<div class="row">
  <div class="col">
    <table class="table table-striped table-bordered table-hover table-sm">
      <thead class="thead-dark">
        <th>Distrito</th>
        <th>Trámites realizados</th>
        <th>Pronóstico</th>
        <th>Faltantes</th>
        <th>Avance</th>
      </thead>
      <tbody>
        {% for row in chart_data %}
        <tr>
          <th>Distrito {{ row.0 }}</th>
          <td>{{ row.1|intcomma }}</td>
          <td>{{ row.2|intcomma }}</td>
          <td>{{ row.3|intcomma }}</td>
          <td>{{ row.4|porciento }}%</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="col">
    <h3>Pronóstico Estatal</h3>
  </div>
</div>

<div class="row">
  <div class="col">
    <div id="estatal_chart" style="width: 100%; height: 500px;"></div>
  </div>
  <div class="col">
    <table class="table table-bordered table-sm table-hover">
      <tr>
        <th>Trámites</th>
        <td>{{ estatal.tramites|intcomma }}</td>
      </tr>
      <tr>
        <th>Pronóstico</th>
        <td>{{ estatal.pronostico|intcomma }}</td>
      </tr>
      <tr>
        <th>Faltantes</th>
        <td>{{ estatal.faltantes|intcomma }}</td>
      </tr>
      <tr>
        <th>Avance</th>
        <td>{{ estatal.porcentaje|porciento }}</td>
      </tr>
    </table>
  </div>
</div>
  
{% endblock content %}
