{% extends 'cerebro/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Carga de encuestas{% endblock %}
{% block head_title %}Carga de encuestas - Cuadro de Mando{% endblock head_title %}

{% block content %}
<div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-4">
  <h1 class="flex items-center gap-3 text-4xl font-bold">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10 text-primary">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z" />
    </svg>
    Subir paquete de encuestas
  </h1>
  <a href="{% url 'vozmac:index' %}" class="btn btn-primary whitespace-nowrap">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
    </svg>
    Regresar a Encuestas</a>
</div>

<div class="space-y-6">
  {% if messages %}
    <div class="space-y-3">
      {% for message in messages %}
        <div class="alert {% if 'success' in message.tags %}alert-success{% elif 'warning' in message.tags %}alert-warning{% elif 'error' in message.tags or 'danger' in message.tags %}alert-error{% else %}alert-info{% endif %} shadow-sm" role="alert">
          <span>{{ message }}</span>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="grid gap-8 lg:grid-cols-3">
    <div class="lg:col-span-1">
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <h2 class="card-title">Subir archivo de encuestas</h2>
          <form method="post" enctype="multipart/form-data" class="flex flex-col gap-6">
            {% csrf_token %}
            {% crispy form %}
            <div class="flex flex-col gap-2 sm:flex-row sm:justify-end">
              <button type="submit" class="btn btn-primary">Subir lote</button>
              <a href="{% url 'vozmac:index' %}" class="btn btn-ghost">Cancelar</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="lg:col-span-2">
      <div class="card bg-base-100 shadow h-full">
        <div class="card-body">
          <h3 class="card-title">Últimas 20 cargas de encuestas</h3>
          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>Archivo</th>
                  <th>MAC</th>
                  <th>Device ID</th>
                  <th>Registros</th>
                  <th>Fecha de carga</th>
                </tr>
              </thead>
              <tbody>
                {% for carga in cargas_recientes %}
                  <tr>
                    <td>{{ carga.file_name }}</td>
                    <td>{{ carga.mac|default:'—' }}</td>
                    <td>{{ carga.device_id|default:'—' }}</td>
                    <td>{{ carga.record_count|default:0 }}</td>
                    <td>{{ carga.uploaded_at|date:'Y-m-d H:i' }}</td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="5" class="text-center text-sm text-base-content/70">No hay cargas recientes.</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
