{% extends 'base.html' %}
{% load static %}

{% block header %}
  <script src="https://fastly.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js"></script>
{% endblock header %}

{% block footer %}
  <script type="text/javascript">
    var dom = document.getElementById('chart-container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};

    var option;

    const colors = ['#5470C6', '#91CC75', '#EE6666'];
    option = {
      color: colors,
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'cross'
        }
      },
      grid: {
        right: '20%'
      },
      toolbox: {
        feature: {
          dataView: { show: true, readOnly: false },
          restore: { show: true },
          saveAsImage: { show: true }
        }
      },
      legend: {
        data: ['Evaporation', 'Precipitation', 'Temperature']
      },
      xAxis: [
        {
          type: 'category',
          axisTick: {
            alignWithLabel: true
          },
          // prettier-ignore
          data: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago']
        }
      ],
      yAxis: [
        {
          type: 'value',
          name: 'Evaporation',
          position: 'right',
          alignTicks: true,
          axisLine: {
            show: true,
            lineStyle: {
              color: colors[0]
            }
          },
          axisLabel: {
            formatter: '{value} ml'
          }
        },
        {
          type: 'value',
          name: 'Precipitation',
          position: 'right',
          alignTicks: true,
          offset: 80,
          axisLine: {
            show: true,
            lineStyle: {
              color: colors[1]
            }
          },
          axisLabel: {
            formatter: '{value} ml'
          }
        },
        {
          type: 'value',
          name: '温度',
          position: 'left',
          alignTicks: true,
          axisLine: {
            show: true,
            lineStyle: {
              color: colors[2]
            }
          },
          axisLabel: {
            formatter: '{value} °C'
          }
        }
      ],
      series: [
        {
          name: 'Evaporation',
          type: 'bar',
          data: [
            2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2
          ]
        },
        {
          name: 'Precipitation',
          type: 'bar',
          yAxisIndex: 1,
          data: [
            2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 175.6, 182.2
          ]
        },
        {
          name: 'Temperature',
          type: 'line',
          yAxisIndex: 2,
          data: [2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4]
        }
      ]
    };

    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
{% endblock footer %}

{% block content %}
<div class="container py-4">
   <div class="p-5 mb-4 bg-body-tertiary rounded-3">
        <h1 class="display-5 fw-bold"><i class="fa fa-line-chart" aria-hidden="true"></i> Objetivos e Indicadores</h1>
        <p class="col fs-4">
          Los Indicadores permiten al Instituto medir el desempeño de sus procesos clave,
          asegurando que cumplan con los estándares de calidad de ISO 9001. Ayudan a
          identificar áreas de mejora continua y a mantener la eficiencia operativa.
          Además, permiten al Instituto tomar decisiones basadas en datos para cumplir
          con los objetivos de calidad establecidos.
        </p>
      </div>
  </div>

  <div class="row">
    <div id="chart-container" style="height:400px;"></div>
  </div>

<pre>
  {% for kpi in kpis %}
    {{ kpi.get_type_display }}: {{ kpi.name }}
    {{ kpi.description }}
    {{ kpi.formula }} - {{ kpi.lapse }}
    {{ kpi.period_set.all }}
    ---
    {% for period in kpi.period_set.all %}
      {{ period.period }}
      {{ period.start }} - {{ period.end }}
      {{ period.target }}: {{ period.nominal }}
      {{ period.total }} -- {{ period.percent }}
      ---
      {% for record in period.record_set.all %}
        {{ record.date|date:"M/Y" }}: {{ record.value }}
      {% endfor %}
    {% endfor %}
  {% endfor %}
</pre>
{% endblock %}
