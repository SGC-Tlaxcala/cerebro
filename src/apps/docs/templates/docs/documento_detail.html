{% extends 'base.html' %}
{% load staticfiles %}

{% block header %}
  <link rel="stylesheet" href="{% static 'docs/estilos.css' %}">
{% endblock header %}

{% block  head_title %}{{ doc.nombre }}{% endblock %}

{% block content %}
  <div class="row">
    <div class="col"><!-- contenido -->
      <div class="page-header">
        <h1 class="display-4">{{ doc.nombre }} <small>{% if doc.proceso.slug != "stn" %}ver. {{ doc.r_actual }}{% endif %} ({{ doc.revision_actual.f_actualizacion }})</small></h1>
      </div><!-- ./page-header -->
    </div>
  </div>
  <div class="row">
    <div class="col">
      {% if doc.proceso.slug == "stn" %}
      <div class="well">
        <h4>Resumen de la opinión técnica</h4>
        {{doc.revision_actual.cambios | safe }}
      </div>
      <hr>
      {% endif %}
    </div>
  </div>
  <div class="row" id="documento">
    <div class="col-md-9" id=""mostrarPDF>
      <div class="row">
        <div class="col">
          {% if doc.ext == 'pdf' %}
            <div class="col">
              <embed src="http://10.29.0.79/media/{{doc.revision_actual.archivo}}" type="application/pdf" width="100%" height="600px" />
            </div>
          {% endif %}
        </div>
      </div>

      {% if doc.proceso.slug != "stn" %}
        <!-- Cambios actuales -->
        <div class="row">
          <div class="col">
            <div class="card bg-light">
              <div class="card-header">Cambios en esta versión</div>
              <div class="card-body">
                {{doc.revision_actual.cambios | safe }}
              </div>
            </div>
          </div>
        </div>
        <!-- ./Cambios actuales -->
      {% endif %}

      <div class="row">
        <div class="col">
          <h4>Historial de actualizaciones</h4>
          <div class="accoridion" id="accordionChanges">
            {% for r in doc.historial %}
            <div class="card">
              <div class="card-header" id="heading{{ forloop.counter }}">
                <h5 class="mb-0">
                  <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}">
                    Revisión <strong>{{ r.revision }}</strong>
                  </button>
                </h5>
              </div>
              <div id="collapse{{ forloop.counter }}" class="collapse" aria-labelledby="heading{{ forloop.counter }}" data-parent="#accordionChanges">
                <div class="card-body">
                  {{ r.cambios | safe }}
                </div>
              </div>
            </div>
            {% endfor %}
          </div><!-- ./#accordionChanges -->
        </div>
      </div>

    </div>

    <div class="col-md-3" id="sidebar">
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header text-white bg-primary">
              <i class="fa fa-key"></i> Código
            </div>
            <div class="card-body">
              <span>{{ doc.clave|upper }}</span>
            </div>
          </div>
        </div>
      </div><!-- ./row código -->
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header text-white bg-info">
              <i class="fa fa-cogs"></i> Proceso
            </div>
            <div class="card-body">
              <span><a href="{% url 'docs:proceso' slug=doc.proceso.slug %}">{{ doc.proceso }}</a></span>
            </div>
          </div>
        </div>
      </div><!-- ./row proceso -->

      {% if doc.proceso.slug == "stn" %}
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header text-white bg-success">
              <i class="fa fa-calendar"></i> Fecha de la opinión
            </div>
            <div class="card-body">
              <span>{{ doc.revision_actual.f_actualizacion }}</span>
            </div>
          </div>
        </div>
      </div>
      {% else %}
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header text-white bg-warning">
              <i class="fa fa-calendar"></i> Revisión
            </div>
            <div class="card-body">
              <span>{{ doc.r_actual }} ({{ doc.revision_actual.f_actualizacion }})</span>
            </div>
          </div>
        </div>
      </div><!-- ./row revisión -->
      {% endif %}

      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header text-white bg-danger">
              <i class="fa fa-cloud-download"></i> Descargar archivo
            </div>
            <div class="card-body">
              <span><a href="{{doc.revision_actual.archivo.url}}">Descargar</a></span>
            </div>
          </div>
        </div>
      </div><!-- ./cad descargar -->

    </div>
  </div>
{% endblock content %}