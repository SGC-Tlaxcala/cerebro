{% extends "base.html" %}
{% load staticfiles %}

{% block head_title %}Resultados de la encuesta de aprobación ciudadana{% endblock %}

{% block footer %}
  {% regroup object_list by fecha as meses %}

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['bar']})
    google.charts.setOnLoadCallback(drawChart)

    function drawChart() {
      let data = google.visualization.arrayToDataTable([
        ['Mes', '290151', '290152', '290153', '290154', '290251', '290253', '290254', '290351', '290352', '290353'],
        {% for datos in meses %}['{{ datos.grouper|date:"N Y"  }}',{% for mac in datos.list %}{{ mac.calificacion }}{% if not forloop.last %}, {% endif %}{% endfor %}]{% if not forloop.last %},{% endif %}
        {% endfor %}
      ])

      const options = {
        chart: {
          title: 'Resultados de la Aprobación Ciudadana'
        },
        animation: {
          duration: 10000,
          startup: true,
          easing: 'inAndOut'
        },
        vAxis: {
          minValue: 8, maxValue: 10,
          viewWindow: {min: 8.6,  max: 10}
        }
      }

      const chart = new google.charts.Bar(document.getElementById('aprobacion'))
      chart.draw(data, google.charts.Bar.convertOptions(options))
    }
  </script>
{% endblock footer %}


{% block content %}
  <div class="row">
    <div class="col">
      <div class="jumbotron">
        <h1 class="display-4"><i class="fa fa-thumbs-o-up"></i> Aprobación Ciudadana</h1>
        <p class="lead">
          Resultados de la aplicación de la encuesta de satisfacción
        </p>
      </div>
    </div>
  </div>
  <div id="aprobacion" style="width: 100%; height: 500px;"></div>
{% endblock content %}
