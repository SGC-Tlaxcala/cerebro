{% extends 'base.html' %}
{% load static %}

{% block content %}
  <div class="row">
    <div class="col-md-12"><!-- contenido -->
      <div class="page-header">
        <h1>{{ doc.nombre }} <small>{% if doc.proceso.slug != "stn" %}ver. {{ doc.r_actual }}{% endif %} ({{ doc.revision_actual.f_actualizacion }})</small></h1>
      </div><!-- ./page-header -->

      <div class="row"><!-- presentacion documento -->
        <div class="col-md-9"><!-- documento en flash -->
          {% if doc.proceso.slug == "stn" %}
          <div class="well">
            <h4>Resumen de la opinión técnica</h4>
            {{doc.revision_actual.cambios | safe }}
          </div>
          <hr>
          {% endif %}

          {% if doc.ext == 'pdf' %}

          <!-- presentacion archivo -->
          <div>
            <iframe style="float:left;" id="viewer" src = "{% static 'viewerjs/index.html' %}#{{MEDIA_URL}}{{doc.revision_actual.archivo}}" width='100%' height='600px' allowfullscreen webkitallowfullscreen></iframe>
          </div>
          <!-- ./presentacion-archivo -->

        {% else %}
          <h4>Este documento no tiene vista preliminar</h4>
          <a href="{{MEDIA_URL}}{{doc.revision_actual.archivo}}">
            <!-- BEGIN imagenes de tipos de archivos -->
            <img style="display:block; vertical-align: middle; margin:auto;" src=
              {% if  doc.ext == 'doc' or doc.ext == 'docx' %}
                  '{{STATIC_URL}}tiles/docx.png'
              {% elif doc.ext == 'xls' or doc.ext == 'xlsx' %}
                  {% static 'tiles/xls.png' %}
              {% elif doc.ext == 'ppt' or doc.ext == 'pptx' %}
                  '{{STATIC_URL}}tiles/ppt.png'
              {% elif doc.ext == 'zip' or doc.ext == 'rar' %}
                  '{{STATIC_URL}}tiles/zip.png'
              {% else %}
                  '{{STATIC_URL}}tiles/otros.png'
              {% endif %}
                width="35%" class="img-polaroid" title="DESCARGAR">
          </a>
          <!-- END imagenes de tipos de archivos -->
      {% endif %}

      {% if doc.proceso.slug != "stn" %}
      <div style="clear: both; margin-top:25px; margin-bottom: 15px;"></div>
      <hr>
      <div class="well">
        <h4>Cambios en esta versión</h4>
        {{doc.revision_actual.cambios }}
      </div>
      {% endif %}
    </div><!-- ./col-md-9 documento en flash -->

    <div class="col-md-3"><!-- meta docs -->

      {% if perms.docs.add_revision %}
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-plus"></i> Agregar Revisión</h3>
        </div>
        <div class="panel-body">
          <a href="/docs/{{ doc.id }}/control">Nueva Revisión</a>
        </div>
      </div>
      {% endif %}

      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-key"></i> Código</h3>
        </div>
        <div class="panel-body">
          {{ doc.clave|upper }}
        </div>
      </div><!-- clave -->

      <div class="panel panel-success">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-cogs"></i> Proceso</h3>
        </div>
        <div class="panel-body">
          <a href="{% url 'docs_proceso' proceso=doc.proceso.slug %}">{{ doc.proceso }}</a>
        </div>
      </div><!-- ./proceso -->

      {% if doc.proceso.slug != "stn" %}
      <div class="panel panel-info">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-calendar"></i> Revisión</h3>
        </div>
        <div class="panel-body">
          <p>{{ doc.r_actual }} ({{ doc.revision_actual.f_actualizacion }})</p>
        </div>
      </div><!-- ./revision -->
      {% endif %}

      {% if doc.proceso.slug == "stn" %}
      <div class="panel panel-info">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-calendar"></i> Fecha la Opinión</h3>
        </div>
        <div class="panel-body">
          <p>{{ doc.revision_actual.f_actualizacion }}</p>
        </div>
      </div><!-- ./revision -->
      {% endif %}

      <div class="panel panel-warning">
        <div class="panel-heading">
          <h3 class="panel-title"><i class="fa fa-cloud-download"></i> Descargar archivo</h3>
        </div>
        <div class="panel-body">
          <a href="{{MEDIA_URL}}{{doc.revision_actual.archivo}}">Descargar</a>
        </div>
      </div><!-- ./Descarga -->

      {% if perms.docs.change_revision %}
        <div class="panel panel-danger">
          <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-pencil"></i> Editar</h3>
          </div>
          <div class="panel-body">
            <a href="{% url 'editar_control' rev=doc.revision_actual.id %}">Editar</a>
          </div>
        </div><!-- ./Descarga -->
      {% endif %}

    </div><!-- ./meta docs -->
  </div><!-- ./row presentacion documento -->
    </div>
  </div>
{% endblock content %}